import{n as e,s as t}from"./index-4579a463.js";const n=[];function i(i,o=e){let a;const r=[];function s(e){if(t(i,e)&&(i=e,a)){const e=!n.length;for(let e=0;e<r.length;e+=1){const t=r[e];t[1](),n.push(t,i)}if(e){for(let e=0;e<n.length;e+=2)n[e][0](n[e+1]);n.length=0}}}return{set:s,update:function(e){s(e(i))},subscribe:function(t,n=e){const c=[t,n];return r.push(c),1===r.length&&(a=o(s)||e),t(i),()=>{const e=r.indexOf(c);-1!==e&&r.splice(e,1),0===r.length&&(a(),a=null)}}}}const o=i({}),a=i({}),r=i([]),s=i([]),c=i([]),u=i([]),l=i(""),d=i({}),f=i(!0),h=i(0),p=i(!1),g=i(!1),m=i([]),b=i([]),v=i([]),y=i([]),k="note",w="note-history",S="feed",E="kanbans";function x(e,t,n){return!!e&&n.indexOf(e)===t}function D(e,t=!1){if(!e)return"";var n=new Date(e),i=n.getDate(),o=n.getMonth()+1,a=n.getFullYear(),r=n.getHours(),s=n.getMinutes(),c=n.getSeconds();return i<10&&(i="0"+i),o<10&&(o="0"+o),r<10&&(r="0"+r),s<10&&(s="0"+s),c<10&&(c="0"+c),t?i+"/"+o+"/"+a:i+"/"+o+"/"+a+" "+r+":"+s+":"+c}function I(e,t){var n,i=[],o={},a=o.format=function(e){return e?(e="/"+e.replace(/^\/|\/$/g,""),n.test(e)&&e.replace(n,"/")):e};return e="/"+(e||"").replace(/^\/|\/$/g,""),n="/"==e?/^\/+/:new RegExp("^\\"+e+"(?=\\/|$)\\/?","i"),o.route=function(t,i){"/"!=t[0]||n.test(t)||(t=e+t),history[(i?"replace":"push")+"State"](t,null,t)},o.on=function(e,t){return(e=function(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,i,o,a,r=[],s="",c=e.split("/");for(c[0]||c.shift();o=c.shift();)"*"===(n=o[0])?(r.push("wild"),s+="/(.*)"):":"===n?(i=o.indexOf("?",1),a=o.indexOf(".",1),r.push(o.substring(1,~i?i:~a?a:o.length)),s+=~i&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(s+=(~i?"?":"")+"\\"+o.substring(a))):s+="/"+o;return{keys:r,pattern:new RegExp("^"+s+(t?"(?=$|/)":"/?$"),"i")}}(e)).fn=t,i.push(e),o},o.run=function(e){var n,r,s=0,c={};if(e=a(e||location.pathname)){for(e=e.match(/[^\?#]*/)[0];s<i.length;s++)if(n=(r=i[s]).pattern.exec(e)){for(s=0;s<r.keys.length;)c[r.keys[s]]=n[++s]||null;return r.fn(c),o}t&&t(e)}return o},o.listen=function(){function e(e){o.run()}function t(e){var t=e.target.closest("a"),i=t&&t.getAttribute("href");e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button||e.defaultPrevented||i&&!t.target&&t.host===location.host&&("/"!=i[0]||n.test(i))&&(e.preventDefault(),o.route(i))}return j("push"),j("replace"),addEventListener("popstate",e),addEventListener("replacestate",e),addEventListener("pushstate",e),addEventListener("click",t),o.unlisten=function(){removeEventListener("popstate",e),removeEventListener("replacestate",e),removeEventListener("pushstate",e),removeEventListener("click",t)},o.run()},o}function j(e,t){history[e]||(history[e]=e,t=history[e+="State"],history[e]=function(n){var i=new Event(e.toLowerCase());return i.uri=n,t.apply(this,arguments),dispatchEvent(i)})}let L,A=firebase.initializeApp({apiKey:"AIzaSyATdwi0PUsJ8NsB4blrNgUTFSGn99xS02U",authDomain:"trangianhuan-github-io.firebaseapp.com",databaseURL:"https://trangianhuan-github-io.firebaseio.com",projectId:"trangianhuan-github-io",storageBucket:"",messagingSenderId:"397638218028",appId:"1:397638218028:web:0bf1e9de2ec91b9e50bc89"}),O=firebase.firestore(A),U="Email unverify";const T=I("/");function N(e,t=!1){"object"==typeof t&&(t=t.replace||!1),T.route(e,t)}function C(){return!!["/icons","/kanban","/note"].includes(location.pathname)}function W(e="/login"){let t=B();C()||0!==Object.keys(t).length&&t.email||N(e,{replace:!0})}function B(){return JSON.parse(localStorage.getItem("user_note"))||{}}function K(e="/note",t=!0){let n=B();if(!t)return n;(0!=Object.keys(n).length||n.email)&&N(e,{replace:!0})}function $(e,t){firebase.auth().signInWithEmailAndPassword(e,t).then(function(e){e&&(o.set(e.user),e.user&&(e.user.emailVerified?"/login"==window.location.pathname&&N("/note",{replace:!1}):(console.log("logout"),P(),h.set(U))))}).catch(function(e){h.set(e.message)})}function J(e,t){firebase.auth().createUserWithEmailAndPassword(e,t).catch(function(e){h.set(e.message)})}function P(){firebase.auth().signOut()}function Q(e){firebase.auth().onAuthStateChanged(function(t){if(f.set(!1),t)o.set(t),h.set(""),localStorage.setItem("user_note",JSON.stringify({email:t.email})),a.set({email:t.email}),t.emailVerified||(t.sendEmailVerification(),h.set("an email verify sended, please check"),P()),"function"==typeof e&&e();else{if(o.set({}),a.set({}),localStorage.setItem("user_note",JSON.stringify({})),C())return;N("/login",{replace:!0})}})}function R(e,t,n){switch(n){case"added":e.push(t);break;case"modified":let i=e.findIndex(e=>e.id===t.id);i>=0&&(e[i]=t);break;case"removed":let o=e.findIndex(e=>e.id===t.id);o>=0&&e.splice(o,1)}return e}function Y(){let e=[],t=[],n=[],i=Date.now()-432e6;O.collection(S).orderBy("public_at","desc").get().then(function(o){o.forEach(function(o){let a=o.data();a.id=o.id,e.push(a.site),t[a.site]=t[a.site]||[],t[a.site].push(a),new Date(a.public_at).getTime()>=i&&(n[a.site]=n[a.site]||[],n[a.site].push(a))}),e=e.filter(x),b.set(e),m.set(t),v.set(n)})}function z(){void 0!==L.email&&O.collection(k).where("email","==",L.email).onSnapshot(function(e){e.docChanges().forEach(function(e){var t=e.doc.data();t.id=e.doc.id,t.pin?function(e,t="added"){s.update(n=>R(n,e,t))}(t,e.type):function(e,t="added"){r.update(n=>R(n,e,t))}(t,e.type),t.notebook&&function(e,t="added"){d.update(n=>{if(n[e.notebook]=n[e.notebook]||[],"added"==t&&n[e.notebook].push(e),"modified"==t){var i=!1;for(var o in n)(a=n[o].find(t=>t.id===e.id))&&(i=!0,(r=n[o].findIndex(t=>t.id===e.id))>=0&&(a.notebook==e.notebook?n[o][r]=e:(n[o].splice(r,1),0==n[o].length&&delete n[o],n[e.notebook]=n[e.notebook]||[],n[e.notebook].push(e))));i||(n[e.notebook]=n[e.notebook]||[],n[e.notebook].push(e))}if("removed"==t)for(var o in valuevalue){var a,r;(a=n[o].find(t=>t.id===e.id))&&(r=n[o].findIndex(t=>t.id===e.id))>=0&&(1==n[o].length?delete n[o]:n[o].splice(r,1))}return n})}(t,e.type),function(e,t="added"){c.update(n=>R(n,e,t))}(t,e.type)})})}function F(){void 0!==L.email&&O.collection(E).where("email","==",L.email).orderBy("epochTime","desc").onSnapshot(function(e){e.docChanges().forEach(function(e){let t=e.doc.data();t.id=e.doc.id,"added"===e.type&&y.update(e=>(e.push(t),e)),e.type,"removed"===e.type&&y.update(e=>{let n=e.findIndex(e=>e.date===t.date);return n>=0&&e.splice(n,1),e})})})}async function V(e,t,n,i,o){if(e||t){if(e=e||"",n=n||"",o=o||"",i=i||!1,L.email){let a=O.collection(k).add({title:e.trim()||"Untitled",content:t,email:L.email,notebook:n.trim(),contentSearch:o.replace(/<[^>]*>?/gm," "),time:(new Date).getTime(),pin:i}).then(function(e){return X(baseUrl+"/icon/awesome-icons/svg/correct-symbol.svg",20,20,"Dữ liệu đã được lưu."),Z(),e.id}).catch(function(e){return Swal.fire("Error!","Add note unsuccess.","error"),"error"});return await a,a}return"error"}}function G(e){const t=e.substring(0,2),n=e.substring(3,5),i=e.substring(6,10);return new Date(i,n,t).getTime()}function H(e){let t=O.batch();(new Date).getTime();for(let n in e){let i=O.collection(E).doc();e[n].email=L.email,e[n].epochTime=G(e[n].date),t.set(i,e[n])}t.commit().then(function(e){return Swal.fire("Created!","Your kanban has been create.","success"),"success"}).catch(function(e){return Swal.fire("Error!","Add kanban unsuccess.","error"),console.log(e),"error"})}async function M(e){if(!e)return"error";const t=O.collection(k).doc(e).delete().then(function(){return Swal.fire("Deleted!","Your note has been deleted.","success"),"success"}).catch(function(e){return Swal.fire("Error!","Your note not has been delete.","error"),"error"});return await t,t}function q(e,t,n,i,o,a){t=t||"",i=i||"",a=a||"",o=o||!1,L.email?O.collection(k).doc(e).set({title:t.trim()||"Untitled",content:n,email:L.email,notebook:i.trim(),contentSearch:a.replace(/<[^>]*>?/gm," "),pin:o}).then(function(){jQuery(".saved").show(),X(baseUrl+"/icon/awesome-icons/svg/correct-symbol.svg",20,20,"Dữ liệu đã được lưu."),Z(),function(e,t,n,i,o,a){(t||n)&&(t=t||"",i=i||"",a=a||"",o=o||!1,L.email?O.collection(w).add({idNote:e,title:t.trim(),content:n,email:L.email,notebook:i.trim(),contentSearch:a.replace(/<[^>]*>?/gm," "),pin:o,timeUpdate:(new Date).getTime()}):console.log("cannot create his note, please login"))}(e,t,n,i.trim(),o)}):console.log("cannot update note, please login")}function X(e,t,n,i){jQuery("#image-mess-note").prop("src",e).css("width",t).css("height",n),i&&jQuery("#mess-note").html(i)}o.subscribe(e=>{L=e});let Z=_.debounce(function(){jQuery(".saved").hide()},2e3);function ee(){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful")},function(e){console.log("ServiceWorker registration failed: ",e)})})}export{u as A,l as B,x as C,V as D,X as E,M as F,q as G,r as H,f as I,I as N,o as a,K as b,W as c,J as d,h as e,y as f,B as g,F as h,ee as i,D as j,H as k,P as l,Y as m,N as n,Q as o,b as p,v as q,m as r,$ as s,z as t,a as u,c as v,s as w,d as x,p as y,g as z};
